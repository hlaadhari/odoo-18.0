<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Vue liste des pièces de rechange -->
        <record id="view_steg_spare_part_tree" model="ir.ui.view">
            <field name="name">steg.spare.part.tree</field>
            <field name="model">steg.spare.part</field>
            <field name="arch" type="xml">
                <tree string="Pièces de Rechange STEG" decoration-danger="stock_status=='out'" 
                      decoration-warning="stock_status=='low'" decoration-success="stock_status=='ok'">
                    <field name="steg_code"/>
                    <field name="name"/>
                    <field name="category_id"/>
                    <field name="equipment_type_id"/>
                    <field name="current_stock"/>
                    <field name="min_stock_level"/>
                    <field name="stock_status" widget="badge" 
                           decoration-danger="stock_status=='out'"
                           decoration-warning="stock_status=='low'"
                           decoration-success="stock_status=='ok'"
                           decoration-info="stock_status=='excess'"/>
                    <field name="criticality" widget="badge"/>
                    <field name="state" widget="badge"/>
                    <field name="manufacturer"/>
                    <field name="standard_price" widget="monetary"/>
                </tree>
            </field>
        </record>

        <!-- Vue formulaire des pièces de rechange -->
        <record id="view_steg_spare_part_form" model="ir.ui.view">
            <field name="name">steg.spare.part.form</field>
            <field name="model">steg.spare.part</field>
            <field name="arch" type="xml">
                <form string="Pièce de Rechange STEG">
                    <header>
                        <button name="action_activate" string="Activer" type="object" 
                                class="btn-primary" invisible="state not in ['draft', 'obsolete']"/>
                        <button name="action_set_obsolete" string="Marquer Obsolète" type="object" 
                                class="btn-secondary" invisible="state != 'active'" 
                                confirm="Êtes-vous sûr de vouloir marquer cette pièce comme obsolète ?"/>
                        <button name="generate_barcode" string="Générer Code-barres" type="object" 
                                class="btn-secondary" invisible="barcode"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,active,obsolete"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_stock_moves" type="object" 
                                    class="oe_stat_button" icon="fa-exchange">
                                <div class="o_stat_info">
                                    <span class="o_stat_text">Mouvements</span>
                                </div>
                            </button>
                            <button name="action_view_current_stock" type="object" 
                                    class="oe_stat_button" icon="fa-cubes">
                                <field name="current_stock" widget="statinfo" string="Stock Actuel"/>
                            </button>
                        </div>
                        
                        <widget name="web_ribbon" title="Obsolète" bg_color="bg-danger" 
                                invisible="state != 'obsolete'"/>
                        <widget name="web_ribbon" title="Stock Critique" bg_color="bg-warning" 
                                invisible="stock_status != 'low'"/>
                        <widget name="web_ribbon" title="Rupture" bg_color="bg-danger" 
                                invisible="stock_status != 'out'"/>

                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Nom de la pièce de rechange"/>
                            </h1>
                            <h2>
                                <field name="steg_code" placeholder="Code STEG (ex: STEG-ELEC-0001)"/>
                            </h2>
                        </div>

                        <group>
                            <group name="basic_info" string="Informations de Base">
                                <field name="category_id"/>
                                <field name="equipment_type_id"/>
                                <field name="barcode" widget="barcode_handler"/>
                                <field name="criticality"/>
                                <field name="is_safety_stock"/>
                                <field name="active"/>
                            </group>
                            <group name="stock_info" string="Informations Stock">
                                <field name="current_stock" readonly="1"/>
                                <field name="min_stock_level"/>
                                <field name="max_stock_level"/>
                                <field name="stock_status" readonly="1"/>
                                <field name="product_id" readonly="1"/>
                            </group>
                        </group>

                        <group>
                            <group name="technical_info" string="Informations Techniques">
                                <field name="manufacturer"/>
                                <field name="manufacturer_ref"/>
                                <field name="maintenance_frequency"/>
                                <field name="last_maintenance_date"/>
                            </group>
                            <group name="financial_info" string="Informations Financières">
                                <field name="standard_price" widget="monetary"/>
                                <field name="last_purchase_price" widget="monetary" readonly="1"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Description" name="description">
                                <field name="description" placeholder="Description détaillée de la pièce de rechange"/>
                            </page>
                            <page string="Spécifications Techniques" name="technical_specs">
                                <field name="technical_specs" placeholder="Spécifications techniques détaillées"/>
                            </page>
                            <page string="Équipements Compatibles" name="equipment">
                                <field name="equipment_ids">
                                    <tree>
                                        <field name="equipment_code"/>
                                        <field name="name"/>
                                        <field name="equipment_type_id"/>
                                        <field name="location_id"/>
                                        <field name="state"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Emplacements de Stock" name="locations">
                                <field name="stock_location_ids">
                                    <tree>
                                        <field name="name"/>
                                        <field name="location_id"/>
                                        <field name="usage"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Fournisseurs" name="suppliers">
                                <field name="supplier_ids">
                                    <tree>
                                        <field name="name"/>
                                        <field name="phone"/>
                                        <field name="email"/>
                                        <field name="city"/>
                                        <field name="supplier_rank"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Vue kanban des pièces de rechange -->
        <record id="view_steg_spare_part_kanban" model="ir.ui.view">
            <field name="name">steg.spare.part.kanban</field>
            <field name="model">steg.spare.part</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile">
                    <field name="steg_code"/>
                    <field name="name"/>
                    <field name="current_stock"/>
                    <field name="stock_status"/>
                    <field name="criticality"/>
                    <field name="state"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_card oe_kanban_global_click">
                                <div class="o_kanban_record_top mb16">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <small class="o_kanban_record_subtitle text-muted">
                                            <field name="steg_code"/>
                                        </small>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <div class="row">
                                            <div class="col-6">
                                                <span class="fa fa-cubes"/> Stock: <field name="current_stock"/>
                                            </div>
                                            <div class="col-6">
                                                <span class="badge" t-attf-class="badge-#{record.stock_status.raw_value == 'ok' ? 'success' : record.stock_status.raw_value == 'low' ? 'warning' : 'danger'}">
                                                    <field name="stock_status"/>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="row mt8">
                                            <div class="col-6">
                                                <span class="badge" t-attf-class="badge-#{record.criticality.raw_value == 'critical' ? 'danger' : record.criticality.raw_value == 'high' ? 'warning' : 'info'}">
                                                    <field name="criticality"/>
                                                </span>
                                            </div>
                                            <div class="col-6">
                                                <span class="badge badge-secondary">
                                                    <field name="state"/>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Vue recherche des pièces de rechange -->
        <record id="view_steg_spare_part_search" model="ir.ui.view">
            <field name="name">steg.spare.part.search</field>
            <field name="model">steg.spare.part</field>
            <field name="arch" type="xml">
                <search string="Rechercher Pièces de Rechange">
                    <field name="name" string="Nom ou Code" 
                           filter_domain="['|', ('name', 'ilike', self), ('steg_code', 'ilike', self)]"/>
                    <field name="steg_code"/>
                    <field name="barcode"/>
                    <field name="category_id"/>
                    <field name="equipment_type_id"/>
                    <field name="manufacturer"/>
                    
                    <separator/>
                    <filter name="active" string="Actif" domain="[('active', '=', True)]"/>
                    <filter name="inactive" string="Inactif" domain="[('active', '=', False)]"/>
                    
                    <separator/>
                    <filter name="stock_ok" string="Stock OK" domain="[('stock_status', '=', 'ok')]"/>
                    <filter name="stock_low" string="Stock Faible" domain="[('stock_status', '=', 'low')]"/>
                    <filter name="stock_out" string="Rupture" domain="[('stock_status', '=', 'out')]"/>
                    
                    <separator/>
                    <filter name="critical" string="Critique" domain="[('criticality', '=', 'critical')]"/>
                    <filter name="high_criticality" string="Criticité Élevée" domain="[('criticality', '=', 'high')]"/>
                    <filter name="safety_stock" string="Stock de Sécurité" domain="[('is_safety_stock', '=', True)]"/>
                    
                    <group expand="0" string="Grouper par">
                        <filter name="group_category" string="Catégorie" context="{'group_by': 'category_id'}"/>
                        <filter name="group_equipment_type" string="Type d'Équipement" context="{'group_by': 'equipment_type_id'}"/>
                        <filter name="group_stock_status" string="Statut Stock" context="{'group_by': 'stock_status'}"/>
                        <filter name="group_criticality" string="Criticité" context="{'group_by': 'criticality'}"/>
                        <filter name="group_manufacturer" string="Fabricant" context="{'group_by': 'manufacturer'}"/>
                        <filter name="group_state" string="État" context="{'group_by': 'state'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Action pour les pièces de rechange -->
        <record id="action_steg_spare_part" model="ir.actions.act_window">
            <field name="name">Pièces de Rechange</field>
            <field name="res_model">steg.spare.part</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="search_view_id" ref="view_steg_spare_part_search"/>
            <field name="context">{
                'search_default_active': 1,
                'search_default_group_category': 1
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Créer votre première pièce de rechange STEG
                </p>
                <p>
                    Gérez efficacement vos pièces de rechange avec le système STEG.
                    Suivez les stocks, gérez les emplacements et optimisez votre maintenance.
                </p>
            </field>
        </record>

        <!-- Action pour les catégories de pièces de rechange -->
        <record id="action_steg_spare_part_category" model="ir.actions.act_window">
            <field name="name">Catégories de Pièces</field>
            <field name="res_model">steg.spare.part.category</field>
            <field name="view_mode">tree,form</field>
        </record>

    </data>
</odoo>