<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vue formulaire stock.picking STEG -->
    <record id="view_picking_form_steg" model="ir.ui.view">
        <field name="name">stock.picking.form.steg</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="steg_division_id"/>
                <field name="steg_request_number"/>
                <field name="steg_urgency"/>
            </xpath>

            <xpath expr="//field[@name='origin']" position="after">
                <field name="steg_requester_id"/>
                <field name="steg_validator_id" readonly="1"/>
                <field name="steg_validation_date" readonly="1"/>
                <field name="steg_validation_state"/>
            </xpath>

            <xpath expr="//page[@name='operations']" position="after">
                <page string="Informations STEG" name="steg_info">
                    <group>
                        <group string="Demande">
                            <field name="steg_purpose" nolabel="1" placeholder="Objet de la demande..."/>
                        </group>
                        <group string="Notes Techniques">
                            <field name="steg_notes" nolabel="1" placeholder="Notes techniques et observations..."/>
                        </group>
                    </group>
                </page>
            </xpath>

            <xpath expr="//header" position="inside">
                <button name="action_submit_for_validation" 
                        type="object" 
                        string="Soumettre pour Validation"
                        class="btn-primary"
                        attrs="{'invisible': [('steg_validation_state', '!=', 'draft')]}"/>
                
                <button name="action_validate_request" 
                        type="object" 
                        string="Valider"
                        class="btn-success"
                        attrs="{'invisible': [('steg_validation_state', '!=', 'submitted')]}"
                        groups="steg_stock_management.group_steg_division_manager"/>
                
                <button name="action_reject_request" 
                        type="object" 
                        string="Rejeter"
                        class="btn-danger"
                        attrs="{'invisible': [('steg_validation_state', '!=', 'submitted')]}"
                        groups="steg_stock_management.group_steg_division_manager"/>
                
                <button name="action_reset_to_draft" 
                        type="object" 
                        string="Remettre en Brouillon"
                        attrs="{'invisible': [('steg_validation_state', 'in', ['draft', 'validated'])]}"
                        groups="steg_stock_management.group_steg_stock_manager"/>

                <field name="steg_validation_state" widget="statusbar" statusbar_visible="draft,submitted,validated"/>
            </xpath>
        </field>
    </record>

    <!-- Vue liste stock.picking STEG -->
    <record id="view_picking_tree_steg" model="ir.ui.view">
        <field name="name">stock.picking.tree.steg</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <field name="steg_request_number"/>
                <field name="steg_division_id"/>
            </xpath>
            <xpath expr="//field[@name='state']" position="after">
                <field name="steg_validation_state"/>
                <field name="steg_urgency"/>
            </xpath>
        </field>
    </record>

    <!-- Vue recherche stock.picking STEG -->
    <record id="view_picking_search_steg" model="ir.ui.view">
        <field name="name">stock.picking.search.steg</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_search"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <field name="steg_request_number"/>
                <field name="steg_division_id"/>
                <field name="steg_requester_id"/>
            </xpath>
            <xpath expr="//filter[@name='late']" position="after">
                <separator/>
                <filter string="En Attente de Validation" name="pending_validation" domain="[('steg_validation_state', '=', 'submitted')]"/>
                <filter string="Validées" name="validated" domain="[('steg_validation_state', '=', 'validated')]"/>
                <filter string="Rejetées" name="rejected" domain="[('steg_validation_state', '=', 'rejected')]"/>
                <separator/>
                <filter string="Urgentes" name="urgent" domain="[('steg_urgency', 'in', ['medium', 'high'])]"/>
                <filter string="Très Urgentes" name="very_urgent" domain="[('steg_urgency', '=', 'high')]"/>
            </xpath>
            <xpath expr="//group[@name='groupby']" position="inside">
                <filter string="Division" name="group_by_division" domain="[]" context="{'group_by': 'steg_division_id'}"/>
                <filter string="État Validation" name="group_by_validation" domain="[]" context="{'group_by': 'steg_validation_state'}"/>
                <filter string="Urgence" name="group_by_urgency" domain="[]" context="{'group_by': 'steg_urgency'}"/>
            </xpath>
        </field>
    </record>

    <!-- Vue formulaire stock.move STEG -->
    <record id="view_move_form_steg" model="ir.ui.view">
        <field name="name">stock.move.form.steg</field>
        <field name="model">stock.move</field>
        <field name="inherit_id" ref="stock.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='product_uom']" position="after">
                <field name="steg_serial_number"/>
                <field name="steg_installation_location"/>
            </xpath>
            <xpath expr="//field[@name='description_picking']" position="after">
                <field name="steg_replacement_reason"/>
            </xpath>
        </field>
    </record>

    <!-- Vue formulaire stock.location STEG -->
    <record id="view_location_form_steg" model="ir.ui.view">
        <field name="name">stock.location.form.steg</field>
        <field name="model">stock.location</field>
        <field name="inherit_id" ref="stock.view_location_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='usage']" position="after">
                <field name="steg_division"/>
                <field name="steg_responsible_id"/>
                <field name="steg_access_level"/>
                <field name="steg_security_level"/>
            </xpath>
            <xpath expr="//field[@name='barcode']" position="after">
                <field name="steg_capacity"/>
                <field name="steg_current_usage" readonly="1"/>
                <field name="steg_temperature_controlled"/>
            </xpath>
            <xpath expr="//page[@name='additional_info']" position="after">
                <page string="Informations STEG" name="steg_location_info">
                    <group>
                        <group string="Maintenance">
                            <field name="steg_last_inventory_date"/>
                            <field name="steg_maintenance_date"/>
                        </group>
                        <group string="Conditions">
                            <field name="steg_climate_conditions"/>
                            <field name="steg_special_requirements"/>
                        </group>
                    </group>
                </page>
            </xpath>
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_inventory_adjustment" 
                        type="object" 
                        class="oe_stat_button" 
                        icon="fa-list">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_text">Inventaire</span>
                    </div>
                </button>
                <button name="action_view_stock_by_product" 
                        type="object" 
                        class="oe_stat_button" 
                        icon="fa-cubes">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_text">Stock</span>
                    </div>
                </button>
            </xpath>
        </field>
    </record>

    <!-- Actions pour les mouvements de stock -->
    <record id="action_steg_picking_in" model="ir.actions.act_window">
        <field name="name">Réceptions STEG</field>
        <field name="res_model">stock.picking</field>
        <field name="view_mode">tree,form,calendar</field>
        <field name="domain">[('picking_type_code', '=', 'incoming')]</field>
        <field name="context">{
            'default_picking_type_id': ref('stock.picking_type_in'),
        }</field>
    </record>

    <record id="action_steg_picking_out" model="ir.actions.act_window">
        <field name="name">Sorties STEG</field>
        <field name="res_model">stock.picking</field>
        <field name="view_mode">tree,form,calendar</field>
        <field name="domain">[('picking_type_code', '=', 'outgoing')]</field>
        <field name="context">{
            'default_picking_type_id': ref('stock.picking_type_out'),
        }</field>
    </record>

    <record id="action_steg_picking_internal" model="ir.actions.act_window">
        <field name="name">Transferts Internes STEG</field>
        <field name="res_model">stock.picking</field>
        <field name="view_mode">tree,form,calendar</field>
        <field name="domain">[('picking_type_code', '=', 'internal')]</field>
        <field name="context">{
            'default_picking_type_id': ref('stock.picking_type_internal'),
        }</field>
    </record>

    <record id="action_steg_stock_location" model="ir.actions.act_window">
        <field name="name">Emplacements STEG</field>
        <field name="res_model">stock.location</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('usage', '=', 'internal')]</field>
    </record>
</odoo>